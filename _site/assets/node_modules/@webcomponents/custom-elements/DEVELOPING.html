<!doctype html>
<html lang="en-US">
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">

    <!-- Begin Jekyll SEO tag v2.3.0 -->
<title>Custom Elements v1 | Dispatch Serverless Framework</title>
<meta property="og:title" content="Custom Elements v1" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Dispatch is a framework for deploying and managing serverless style applications." />
<meta property="og:description" content="Dispatch is a framework for deploying and managing serverless style applications." />
<link rel="canonical" href="http://localhost:4000/dispatch/assets/node_modules/@webcomponents/custom-elements/DEVELOPING.html" />
<meta property="og:url" content="http://localhost:4000/dispatch/assets/node_modules/@webcomponents/custom-elements/DEVELOPING.html" />
<meta property="og:site_name" content="Dispatch Serverless Framework" />
<script type="application/ld+json">
{"name":null,"description":"Dispatch is a framework for deploying and managing serverless style applications.","author":null,"@type":"WebPage","url":"http://localhost:4000/dispatch/assets/node_modules/@webcomponents/custom-elements/DEVELOPING.html","publisher":null,"image":null,"headline":"Custom Elements v1","dateModified":null,"datePublished":null,"sameAs":null,"mainEntityOfPage":null,"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/dispatch/assets/node_modules/@clr/icons/clr-icons.min.css">
    <script src="/dispatch/assets/node_modules/@webcomponents/custom-elements/custom-elements.min.js"></script>
    <script src="/dispatch/assets/node_modules/@clr/icons/clr-icons.min.js"></script>
    <script src="/dispatch/assets/node_modules/anchor-js/anchor.js"></script>
    <link rel="stylesheet" href="/dispatch/assets/node_modules/@clr/ui/clr-ui.min.css">
    <script defer src="https://use.fontawesome.com/releases/v5.0.7/js/all.js"></script>
    <link rel="stylesheet" href="/dispatch/assets/css/style.css?v=cd131ece455317a0ce1219b8b78ef55e8e6bf546">
    <meta name="viewport" content="width=device-width">
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/dispatch/assets/images/dispatch.ico/apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="/dispatch/assets/images/dispatch.ico/apple-touch-icon-152x152.png" />
    <link rel="icon" type="image/png" href="/dispatch/assets/images/dispatch.ico/favicon-32x32.png" sizes="32x32" />
    <link rel="icon" type="image/png" href="/dispatch/assets/images/dispatch.ico/favicon-16x16.png" sizes="16x16" />
    <meta name="application-name" content="&nbsp;"/>
    <meta name="msapplication-TileColor" content="#FFFFFF" />
    <meta name="msapplication-TileImage" content="/dispatch/assets/images/dispatch.ico/mstile-144x144.png" />

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
</head>
    <body>
        <clr-main-container class="main-container">
        <clr-header class="header-6 header">
    <button class="header-hamburger-trigger" type="button">
        <span></span>
    </button>

    <div class="branding">
        <a class="logo-and-title" routerlink="/" href="http://github.com/vmware/dispatch">
            <!-- <span class="clr-icon clarity-logo"></span>
            <span class="title">Project Dispatch</span> -->
            <img class="dispatch-logo" src="/dispatch/assets/images/logo-small-200.png">
        </a>
    </div>
    <div class="divider"></div>
    <div class="header-nav clr-nav-level-1">
        <a class="nav-link " id="home-link" routerlink="/" routerlinkactive="active" href="/dispatch/"><span class="nav-text">Home</span></a>
        <a class="nav-link " routerlink="/documentation" routerlinkactive="active" href="/dispatch/documentation/front/overview"><span class="nav-text">Documentation</span></a>
        <a class="nav-link " routerlink="/code" routerlinkactive="active" href="/dispatch/code"><span class="nav-text">Code</span></a>
        <a class="nav-link " routerlink="/community" routerlinkactive="active" href="/dispatch/community"><span class="nav-text">Community</span></a>
        <a class="nav-link " routerlink="/news" routerlinkactive="active" href="/dispatch/news"><span class="nav-text">What's New</span></a>
    </div>
    <div class="settings">
        <iframe class="github-btn" frameborder="0" height="20px" scrolling="0" src="https://ghbtns.com/github-btn.html?user=vmware&repo=dispatch&type=star&count=true" width="170px"></iframe>
    </div>

    <button class="header-overflow-trigger" type="button">
        <span></span>
    </button>
    <div class="header-backdrop"></div>
</clr-header>

            <documentation class="content-container"><router-outlet></router-outlet>
                <div class="content-area">
                    <section class="dox-content">
                    <h1 id="custom-elements-v1">Custom Elements v1</h1>

<h2 id="status">Status</h2>

<p>The polyfill should be mostly feature complete now. It supports defining
custom elements, the custom element reactions, and upgrading existing elements. It integrates with native Shadow DOM v1, and native and polyfilled HTML Imports.</p>

<p>The implementation could use more tests, especially around ordering of
reactions. The source references old versions of the spec.</p>

<h3 id="to-do">To do</h3>

<ol>
  <li>Implement Node#isConnected</li>
  <li>Implement built-in element extension (is=)</li>
  <li>Add reaction callback ordering tests</li>
  <li>Reorganize tests to be closer to spec structure</li>
  <li>Performance tests</li>
</ol>

<h2 id="building--running-tests">Building &amp; Running Tests</h2>

<ol>
  <li>Install web-component-tester</li>
</ol>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>```bash
$ npm i -g web-component-tester
```
</code></pre></div></div>

<ol>
  <li>Checkout the webcomponentsjs v1 branch</li>
</ol>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>```bash
$ git clone https://github.com/webcomponents/webcomponentsjs.git
$ cd webcomponentsjs
$ npm i
$ gulp build
```
</code></pre></div></div>

<ol>
  <li>Run tests</li>
</ol>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>```bash
$ wct tests/CustomElements/v1/index.html -l chrome
```
</code></pre></div></div>

<ol>
  <li>Bower link to use in another project</li>
</ol>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>```bash
$ bower link
$ cd {your project directory}
$ bower link webcomponentsjs
```
</code></pre></div></div>

<h2 id="implementation-approach-and-browser-support">Implementation approach and browser support</h2>

<p>The polyfill leans heavily on MutationObservers to drive custom element creation and reactions. This means that the polyfill requires native or polyfilled MutationObservers. The polyfill also uses Map and Set, though those would be easy to polyfill or remove.</p>

<p>The implementation should work without additional polyfills in IE 11, Edge, Safari &gt;6, Firefox, Chrome, Android Browser &gt;4.4, and Opera (not Mini).</p>

<p>IE 10 should be supported with the Mutation Observer polyfill.</p>

<p>This branch does not pass the CI tests yet, but it passes locally in Chrome 52, Safari 9.1, Safari Technical Preview, and Firefox 47.</p>

<p>Because MutationObservers are used to create custom element instances and react to document structure and attribute changes, all reactions are asynchronous while in the specs, some are synchronous. This is by design, since some of the synchronous reactions are impossible to polyfill. We consider it more important that reactions have the same relative timing to each other as the spec, for example attributeChangedCallback happens after connectedCallback.</p>

<h3 id="implementing-the-constructor-call-trick">Implementing the “Constructor-call Trick”</h3>

<p>The HTMLElement constructor is now specified to return a different object than <code class="highlighter-rouge">this</code>, so that the parser and upgrades can call the constructor on elements that have already been allocated. JavaScript allows this, but some compilers, such as TypeScript and Closure currently don’t.</p>

<p>The HTMLElement constructor is also specified to look up the tag name associated with a constructor by using <code class="highlighter-rouge">new.target</code>. <code class="highlighter-rouge">new.target</code> isn’t available in ES5, is not polyfillable, but <code class="highlighter-rouge">this.constructor</code> behaves similarly for most ES5 class patterns, including the output of Babel, TypeScript and Closure, so the polyfill uses that to look up tag names.</p>

<p><code class="highlighter-rouge">new.target</code> isn’t even feature detectable, since it’s a syntax error in ES5. Because of this, the polyfill can’t check <code class="highlighter-rouge">new.target</code> first and fallback to <code class="highlighter-rouge">this.constructor</code>. This also means that ES5-style constructors can’t conditionally make a “super” call to the HTMLElement constructor (with <code class="highlighter-rouge">Reflect.construct</code>) in non-ES6 environments to be compatible with native Custom Elements.</p>

<p>To allow for elements that work in both ES5 and ES6 environments, we provide a shim to be used in browsers that have native Custom Elements v1 support, that overrides the HTMLElement constructor and calls <code class="highlighter-rouge">Reflect.construct</code> with either the value of <code class="highlighter-rouge">new.target</code> or <code class="highlighter-rouge">this.constructor</code>. This shim can only be executed in ES6 environments that support <code class="highlighter-rouge">new.target</code>, and so should be conditionally loaded. The shim and the polyfill should not be loaded at the same time.</p>

<h2 id="building">Building</h2>

<p>The Custom Elements V1 polyfill does not use the same module or build system as
the other webcomponentsjs polyfills, and its build is not integrated into the default build tasks yet.</p>

<p>To build run:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gulp
</code></pre></div></div>

<p>This creates a <code class="highlighter-rouge">custom-elements.min.js</code> file in the main directory.</p>

<h2 id="custom-elements-in-the-dom-spec">Custom Elements in the DOM Spec</h2>

<h3 id="423-mutation-algorithms">4.2.3 Mutation Algorithms</h3>

<p>https://dom.spec.whatwg.org/#mutation-algorithms</p>

<ul>
  <li>insert 6.5.2.1: call connectedCallback</li>
  <li>insert 6.5.2.2: upgrade</li>
  <li>remove 14: call disconnectedCallback</li>
  <li>remove 15.2: call disconnectedCallback</li>
</ul>

<h3 id="44-node">4.4 Node</h3>

<p>https://dom.spec.whatwg.org/#concept-node-clone</p>

<ul>
  <li>clone 2.1: performs create-element</li>
  <li>clone 2.2: append attributes</li>
</ul>

<p>isConnected looks like it’s Custom Elements related, but it’s actually part of Shadow DOM. We might want to implement it for on non-native Shadow DOM environments, since we already watch for all connections and disconnections.</p>

<h3 id="45-document">4.5 Document</h3>

<p>https://dom.spec.whatwg.org/#interface-document</p>

<ul>
  <li>createElement and createElementNS take ElementCreationOptions</li>
</ul>

<p>https://dom.spec.whatwg.org/#dom-document-createelement</p>

<ul>
  <li>createElement 3, 4, 5, 7</li>
  <li>createElementNS 2, 3, 4, 5</li>
</ul>

<h3 id="49-element">4.9 Element</h3>

<p>https://dom.spec.whatwg.org/#concept-element-custom-element-state</p>

<p>https://dom.spec.whatwg.org/#concept-create-element</p>

<ul>
  <li>create an element 2, 3, 4, 5, 6</li>
</ul>

<p>https://dom.spec.whatwg.org/#concept-element-attributes-change</p>

<ul>
  <li>change an attribute 2</li>
</ul>

<p>https://dom.spec.whatwg.org/#concept-element-attributes-append</p>

<ul>
  <li>append an attribute 2</li>
</ul>

<p>https://dom.spec.whatwg.org/#concept-element-attributes-remove</p>

<ul>
  <li>remove an attribute 2</li>
</ul>

<p>https://dom.spec.whatwg.org/#concept-element-attributes-replace</p>

<ul>
  <li>replace an attribute 2</li>
</ul>

<p>https://dom.spec.whatwg.org/#dom-element-attachshadow</p>

<ul>
  <li>attachShadow 2 (nothing to implement)</li>
</ul>

<h2 id="custom-elements-in-the-html-spec">Custom Elements in the HTML Spec</h2>

<h3 id="323-html-element-constructors">3.2.3 HTML element constructors</h3>

<p>https://html.spec.whatwg.org/multipage/dom.html#html-element-constructors</p>

<ul>
  <li>HTML element constructors 1-9</li>
</ul>

<h3 id="413-custom-elements">4.13 Custom Elements</h3>

<p>https://html.spec.whatwg.org/multipage/scripting.html#custom-elements</p>

<p>https://html.spec.whatwg.org/multipage/scripting.html#valid-custom-element-name</p>

<p>https://html.spec.whatwg.org/multipage/scripting.html#customelementsregistry</p>

<h3 id="73-window">7.3 Window</h3>

<p>https://html.spec.whatwg.org/multipage/browsers.html#window</p>

<ul>
  <li>Window#customElements</li>
</ul>

<p>https://html.spec.whatwg.org/multipage/syntax.html#create-an-element-for-the-token</p>

<ul>
  <li>create an element for a token 3, 4, 5, 6, 7, 8, 9</li>
</ul>

                    </section>
                </div>

                <nav class="sidenav clr-nav-level-2">
                    <section class="sidenav-content">
                    

                    
                    
                        <!-- front section is top level and has no label -->
                        <section class="nav-group collapsible">

                        
                            <ul class="nav-list">
                                <documentation-nav-links type="">
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/front/overview">Overview</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/front/roadmap">Roadmap</a></li>
                                
                                
                                </documentation-nav-links>
                            </ul>
                        </section>
                    
                    
                    
                        <!-- front section is top level and has no label -->
                        <section class="nav-group collapsible">

                        
                        
                            
                            <input id="Guides" type="checkbox" checked>
                            
                            <label for="Guides">Guides</label>
                        
                        
                            <ul class="nav-list">
                                <documentation-nav-links type="Guides">
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/guides/building">Building</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/guides/built-in-event-drivers">Built In Event Drivers</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/guides/custom-event-drivers">Custom Event Drivers</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/guides/docker-for-mac">Docker For Mac</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/guides/gke">Gke</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/guides/minikube">Minikube</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/guides/quickstart">Quickstart</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/guides/setup-authentication">Setup Authentication</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/guides/setup-service-acccount-authentication">Setup Service Acccount Authentication</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/guides/troubleshooting">Troubleshooting</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/guides/working-with-events">Working With Events</a></li>
                                
                                
                                </documentation-nav-links>
                            </ul>
                        </section>
                    
                    
                    
                        <!-- front section is top level and has no label -->
                        <section class="nav-group collapsible">

                        
                        
                            
                            <input id="posts" type="checkbox" checked>
                            
                            <label for="posts">Posts</label>
                        
                        
                            <ul class="nav-list">
                                <documentation-nav-links type="">
                                
                                
                                    <li><a class="nav-link" href="/dispatch/2018/05/23/v0-1-15-release.html">v0.1.15 Dispatch Release</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/2018/06/06/v0-1-16-release.html">v0.1.16 Dispatch Release</a></li>
                                
                                
                                </documentation-nav-links>
                            </ul>
                        </section>
                    
                    
                    
                        <!-- front section is top level and has no label -->
                        <section class="nav-group collapsible">

                        
                        
                            
                            <input id="Specifications" type="checkbox" checked>
                            
                            <label for="Specifications">Specifications</label>
                        
                        
                            <ul class="nav-list">
                                <documentation-nav-links type="Specifications">
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/specs/api-gateway">Api Gateway</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/specs/application">Application</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/specs/development">Development</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/specs/dispatch">Dispatch</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/specs/error-handling">Error Handling</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/specs/event-gateway">Event Gateway</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/specs/event-manager">Event Manager</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/specs/function-gateway">Function Gateway</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/specs/function-schema-validation">Function Schema Validation</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/specs/identity-management">Identity Management</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/specs/image-manager">Image Manager</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/specs/language-support">Language Support</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/specs/rest-api">Rest Api</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/specs/secrets-store">Secrets Store</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/specs/service-manager">Service Manager</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/specs/terminology">Terminology</a></li>
                                
                                
                                </documentation-nav-links>
                            </ul>
                        </section>
                    
                    
                    
                        <!-- front section is top level and has no label -->
                        <section class="nav-group collapsible">

                        
                        
                            
                            <input id="Usage" type="checkbox" checked>
                            
                            <label for="Usage">Usage</label>
                        
                        
                            <ul class="nav-list">
                                <documentation-nav-links type="Usage">
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/usage/api">API Endpoints</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/usage/event-drivers">Events Drivers and Subscriptions</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/usage/functions">Functions</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/usage/iam">Roles and Policies</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/usage/images">Images and Base Images</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/usage/services">Services Integration</a></li>
                                
                                
                                </documentation-nav-links>
                            </ul>
                        </section>
                    
                    
                    </section>
                </nav>
            </documentation>
        <footer></footer>
<script>
    anchors.add();
</script>
<script src="/dispatch/assets/js/scale.fix.js"></script>
        </clr-main-container>
    </body>
</html>