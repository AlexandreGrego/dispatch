<!doctype html>
<html lang="en-US">
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">

    <!-- Begin Jekyll SEO tag v2.3.0 -->
<title>Function Schema Validation | Dispatch Serverless Framework</title>
<meta property="og:title" content="Function Schema Validation" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Function Input/Output Data Schemas" />
<meta property="og:description" content="Function Input/Output Data Schemas" />
<link rel="canonical" href="http://localhost:4000/dispatch/documentation/specs/function-schema-validation" />
<meta property="og:url" content="http://localhost:4000/dispatch/documentation/specs/function-schema-validation" />
<meta property="og:site_name" content="Dispatch Serverless Framework" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-06-11T14:24:45-07:00" />
<script type="application/ld+json">
{"name":null,"description":"Function Input/Output Data Schemas","author":null,"@type":"BlogPosting","url":"http://localhost:4000/dispatch/documentation/specs/function-schema-validation","publisher":null,"image":null,"headline":"Function Schema Validation","dateModified":"2018-06-11T14:24:45-07:00","datePublished":"2018-06-11T14:24:45-07:00","sameAs":null,"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/dispatch/documentation/specs/function-schema-validation"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/dispatch/assets/node_modules/@clr/icons/clr-icons.min.css">
    <script src="/dispatch/assets/node_modules/@webcomponents/custom-elements/custom-elements.min.js"></script>
    <script src="/dispatch/assets/node_modules/@clr/icons/clr-icons.min.js"></script>
    <script src="/dispatch/assets/node_modules/anchor-js/anchor.js"></script>
    <link rel="stylesheet" href="/dispatch/assets/node_modules/@clr/ui/clr-ui.min.css">
    <script defer src="https://use.fontawesome.com/releases/v5.0.7/js/all.js"></script>
    <link rel="stylesheet" href="/dispatch/assets/css/style.css?v=cd131ece455317a0ce1219b8b78ef55e8e6bf546">
    <meta name="viewport" content="width=device-width">
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/dispatch/assets/images/dispatch.ico/apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="/dispatch/assets/images/dispatch.ico/apple-touch-icon-152x152.png" />
    <link rel="icon" type="image/png" href="/dispatch/assets/images/dispatch.ico/favicon-32x32.png" sizes="32x32" />
    <link rel="icon" type="image/png" href="/dispatch/assets/images/dispatch.ico/favicon-16x16.png" sizes="16x16" />
    <meta name="application-name" content="&nbsp;"/>
    <meta name="msapplication-TileColor" content="#FFFFFF" />
    <meta name="msapplication-TileImage" content="/dispatch/assets/images/dispatch.ico/mstile-144x144.png" />

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
</head>
    <body>
        <clr-main-container class="main-container">
        <clr-header class="header-6 header">
    <button class="header-hamburger-trigger" type="button">
        <span></span>
    </button>

    <div class="branding">
        <a class="logo-and-title" routerlink="/" href="http://github.com/vmware/dispatch">
            <!-- <span class="clr-icon clarity-logo"></span>
            <span class="title">Project Dispatch</span> -->
            <img class="dispatch-logo" src="/dispatch/assets/images/logo-small-200.png">
        </a>
    </div>
    <div class="divider"></div>
    <div class="header-nav clr-nav-level-1">
        <a class="nav-link " id="home-link" routerlink="/" routerlinkactive="active" href="/dispatch/"><span class="nav-text">Home</span></a>
        <a class="nav-link active" routerlink="/documentation" routerlinkactive="active" href="/dispatch/documentation/front/overview"><span class="nav-text">Documentation</span></a>
        <a class="nav-link " routerlink="/code" routerlinkactive="active" href="/dispatch/code"><span class="nav-text">Code</span></a>
        <a class="nav-link " routerlink="/community" routerlinkactive="active" href="/dispatch/community"><span class="nav-text">Community</span></a>
        <a class="nav-link " routerlink="/news" routerlinkactive="active" href="/dispatch/news"><span class="nav-text">What's New</span></a>
    </div>
    <div class="settings">
        <iframe class="github-btn" frameborder="0" height="20px" scrolling="0" src="https://ghbtns.com/github-btn.html?user=vmware&repo=dispatch&type=star&count=true" width="170px"></iframe>
    </div>

    <button class="header-overflow-trigger" type="button">
        <span></span>
    </button>
    <div class="header-backdrop"></div>
</clr-header>

            <documentation class="content-container"><router-outlet></router-outlet>
                <div class="content-area">
                    <section class="dox-content">
                    <h1 id="function-inputoutput-data-schemas">Function Input/Output Data Schemas</h1>

<h2 id="current-issues">Current Issues</h2>

<p>Incoming event data is mostly expected to have a certain structure that can be formally checked before handing the data
to a serverless function (which currently is not done).</p>

<p>Function developer has to put input data validation code in every function, which is</p>
<ul>
  <li>repetitive,</li>
  <li>additional potential source of bugs.</li>
</ul>

<p>The same applies to function return values (objects).</p>

<h2 id="proposed-solution">Proposed Solution</h2>

<p>Data validation service integrated with Dispatch.</p>
<ul>
  <li>Should be built-in into Dispatch for performance reasons.</li>
  <li>Implemented as a middleware wrapping around function calls.</li>
</ul>

<p>Additionally, based on the function input/output schemas, we could generate function stubs, that would be able to
receive (and validate) events and emit conforming (but random) payloads.</p>

<h2 id="requirements">Requirements</h2>

<ul>
  <li>Data validation is optional</li>
  <li>Configurable using the CLI</li>
  <li>Schemas themselves are checked for correctness when registered</li>
  <li>Schema sources are in YAML or JSON files (alongside the validated functions’ source files)</li>
</ul>

<h2 id="design">Design</h2>

<p>The parts of Dispatch dealing with schemas and validation are: CLI, API, function execution runtime, data store.</p>

<p><img src="function-schema-validation.png" alt="function-schema-validation" title="Validation Design" /></p>

<h3 id="schemas-and-namespaces">Schemas and Namespaces</h3>

<p>Schemas, along with functions, are grouped using namespaces, e.g. <code class="highlighter-rouge">/elastic-sky.pizza/schemas/Product</code></p>

<h3 id="cli">CLI</h3>

<h4 id="crud-schemas">CRUD schemas</h4>

<p><code class="highlighter-rouge">create</code>, <code class="highlighter-rouge">get</code>, <code class="highlighter-rouge">update</code>, <code class="highlighter-rouge">delete</code>. E.g. create schema:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vs schema create <span class="se">\</span>
    <span class="nt">--source</span> ./order-in.yaml <span class="se">\</span>
    /elastic-sky.pizza/schemas/order-in
</code></pre></div></div>

<h4 id="use-schemas">Use schemas</h4>

<p>Specify function input and/or output schemas:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vs <span class="k">function </span>create <span class="se">\</span>
    <span class="nt">--input-schema</span> /elastic-sky.pizza/schemas/order-in <span class="se">\</span>
    <span class="nt">--output-schema</span> /elastic-sky.pizza/schemas/order-out <span class="se">\</span>
    <span class="nt">--source</span> order.js
    /elastic-sky.pizza/order
</code></pre></div></div>

<p>Disassociate input and/or output schema for a function:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vs <span class="k">function </span>update <span class="se">\</span>
    <span class="nt">--output-schema</span> none <span class="se">\</span>
    /elastic-sky.pizza/order
</code></pre></div></div>

<p>Validate a piece of data (convenience command to be used during function development/debugging):</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vs schema validate /elastic-sky.pizza/schemas/order-in &lt; ./data.json
</code></pre></div></div>

<h3 id="api">API</h3>

<p>REST API endpoint (schema CRUD operations): <code class="highlighter-rouge">/schemas</code></p>

<h3 id="function-invocation-data-flow">Function Invocation Data Flow</h3>

<p>When a function with input validation configured is invoked:</p>

<ol>
  <li>
    <p>The invocation record has just been created. Record state <code class="highlighter-rouge">intercepted-before</code> for the invocation.</p>
  </li>
  <li>If input data schema is set and input validation is turned on, validate the input event data.
    <ul>
      <li>If the data is not valid:</li>
    </ul>
    <ol>
      <li>Record state <code class="highlighter-rouge">input-invalid</code> for the invocation.</li>
      <li>Emit <strong>data validation error</strong> event with the details (what’s invalid) and record reference to it in the <em>output
event</em> property of the invocation.</li>
      <li>Finish processing the invocation.</li>
    </ol>
  </li>
  <li>Proceed with the invocation and deliver the input event data to the function.</li>
</ol>

<p>When the function code has just successfully returned:</p>

<ol>
  <li>
    <p>The function produces output (by returning a value/object).</p>
  </li>
  <li>
    <p>Validate the output data. Normally, the data is valid and we just proceed.</p>
    <ul>
      <li>If the data does not conform to schema:</li>
    </ul>
    <ol>
      <li>Record state <code class="highlighter-rouge">output-invalid</code> for the invocation.</li>
      <li>Emit <strong>data validation error</strong> event with the details (what’s invalid) and record reference to it in the <em>output
event</em> property of the invocation.</li>
      <li>Finish processing the invocation.</li>
    </ol>
  </li>
</ol>

<h3 id="persistence">Persistence</h3>

<p>Schemas are stored in the Dispatch data store.</p>

<h2 id="milestones">Milestones</h2>

<p>TBD</p>

<h2 id="open-issues">Open Issues</h2>

<p>TBD</p>

                    </section>
                </div>

                <nav class="sidenav clr-nav-level-2">
                    <section class="sidenav-content">
                    

                    
                    
                        <!-- front section is top level and has no label -->
                        <section class="nav-group collapsible">

                        
                            <ul class="nav-list">
                                <documentation-nav-links type="">
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/front/overview">Overview</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/front/roadmap">Roadmap</a></li>
                                
                                
                                </documentation-nav-links>
                            </ul>
                        </section>
                    
                    
                    
                        <!-- front section is top level and has no label -->
                        <section class="nav-group collapsible">

                        
                        
                            
                            <input id="Guides" type="checkbox" checked>
                            
                            <label for="Guides">Guides</label>
                        
                        
                            <ul class="nav-list">
                                <documentation-nav-links type="Guides">
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/guides/building">Building</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/guides/built-in-event-drivers">Built In Event Drivers</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/guides/custom-event-drivers">Custom Event Drivers</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/guides/docker-for-mac">Docker For Mac</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/guides/gke">Gke</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/guides/minikube">Minikube</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/guides/quickstart">Quickstart</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/guides/setup-authentication">Setup Authentication</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/guides/setup-service-acccount-authentication">Setup Service Acccount Authentication</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/guides/troubleshooting">Troubleshooting</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/guides/working-with-events">Working With Events</a></li>
                                
                                
                                </documentation-nav-links>
                            </ul>
                        </section>
                    
                    
                    
                        <!-- front section is top level and has no label -->
                        <section class="nav-group collapsible">

                        
                        
                            
                            <input id="posts" type="checkbox" checked>
                            
                            <label for="posts">Posts</label>
                        
                        
                            <ul class="nav-list">
                                <documentation-nav-links type="">
                                
                                
                                    <li><a class="nav-link" href="/dispatch/2018/05/23/v0-1-15-release.html">v0.1.15 Dispatch Release</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/2018/06/06/v0-1-16-release.html">v0.1.16 Dispatch Release</a></li>
                                
                                
                                </documentation-nav-links>
                            </ul>
                        </section>
                    
                    
                    
                        <!-- front section is top level and has no label -->
                        <section class="nav-group collapsible">

                        
                        
                            
                            <input id="Specifications" type="checkbox">
                            
                            <label for="Specifications">Specifications</label>
                        
                        
                            <ul class="nav-list">
                                <documentation-nav-links type="Specifications">
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/specs/api-gateway">Api Gateway</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/specs/application">Application</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/specs/development">Development</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/specs/dispatch">Dispatch</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/specs/error-handling">Error Handling</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/specs/event-gateway">Event Gateway</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/specs/event-manager">Event Manager</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/specs/function-gateway">Function Gateway</a></li>
                                
                                
                                
                                    <li><a class="nav-link active" routerlinkactive="active" href="/dispatch/documentation/specs/function-schema-validation">Function Schema Validation</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/specs/identity-management">Identity Management</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/specs/image-manager">Image Manager</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/specs/language-support">Language Support</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/specs/rest-api">Rest Api</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/specs/secrets-store">Secrets Store</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/specs/service-manager">Service Manager</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/specs/terminology">Terminology</a></li>
                                
                                
                                </documentation-nav-links>
                            </ul>
                        </section>
                    
                    
                    
                        <!-- front section is top level and has no label -->
                        <section class="nav-group collapsible">

                        
                        
                            
                            <input id="Usage" type="checkbox" checked>
                            
                            <label for="Usage">Usage</label>
                        
                        
                            <ul class="nav-list">
                                <documentation-nav-links type="Usage">
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/usage/api">API Endpoints</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/usage/event-drivers">Events Drivers and Subscriptions</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/usage/functions">Functions</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/usage/iam">Roles and Policies</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/usage/images">Images and Base Images</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/usage/services">Services Integration</a></li>
                                
                                
                                </documentation-nav-links>
                            </ul>
                        </section>
                    
                    
                    </section>
                </nav>
            </documentation>
        <footer></footer>
<script>
    anchors.add();
</script>
<script src="/dispatch/assets/js/scale.fix.js"></script>
        </clr-main-container>
    </body>
</html>