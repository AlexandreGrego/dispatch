<!doctype html>
<html lang="en-US">
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">

    <!-- Begin Jekyll SEO tag v2.3.0 -->
<title>Service Manager | Dispatch Serverless Framework</title>
<meta property="og:title" content="Service Manager" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Service Manager" />
<meta property="og:description" content="Service Manager" />
<link rel="canonical" href="http://localhost:4000/dispatch/documentation/specs/service-manager" />
<meta property="og:url" content="http://localhost:4000/dispatch/documentation/specs/service-manager" />
<meta property="og:site_name" content="Dispatch Serverless Framework" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-06-11T14:24:45-07:00" />
<script type="application/ld+json">
{"name":null,"description":"Service Manager","author":null,"@type":"BlogPosting","url":"http://localhost:4000/dispatch/documentation/specs/service-manager","publisher":null,"image":null,"headline":"Service Manager","dateModified":"2018-06-11T14:24:45-07:00","datePublished":"2018-06-11T14:24:45-07:00","sameAs":null,"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/dispatch/documentation/specs/service-manager"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/dispatch/assets/node_modules/@clr/icons/clr-icons.min.css">
    <script src="/dispatch/assets/node_modules/@webcomponents/custom-elements/custom-elements.min.js"></script>
    <script src="/dispatch/assets/node_modules/@clr/icons/clr-icons.min.js"></script>
    <script src="/dispatch/assets/node_modules/anchor-js/anchor.js"></script>
    <link rel="stylesheet" href="/dispatch/assets/node_modules/@clr/ui/clr-ui.min.css">
    <script defer src="https://use.fontawesome.com/releases/v5.0.7/js/all.js"></script>
    <link rel="stylesheet" href="/dispatch/assets/css/style.css?v=cd131ece455317a0ce1219b8b78ef55e8e6bf546">
    <meta name="viewport" content="width=device-width">
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/dispatch/assets/images/dispatch.ico/apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="/dispatch/assets/images/dispatch.ico/apple-touch-icon-152x152.png" />
    <link rel="icon" type="image/png" href="/dispatch/assets/images/dispatch.ico/favicon-32x32.png" sizes="32x32" />
    <link rel="icon" type="image/png" href="/dispatch/assets/images/dispatch.ico/favicon-16x16.png" sizes="16x16" />
    <meta name="application-name" content="&nbsp;"/>
    <meta name="msapplication-TileColor" content="#FFFFFF" />
    <meta name="msapplication-TileImage" content="/dispatch/assets/images/dispatch.ico/mstile-144x144.png" />

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
</head>
    <body>
        <clr-main-container class="main-container">
        <clr-header class="header-6 header">
    <button class="header-hamburger-trigger" type="button">
        <span></span>
    </button>

    <div class="branding">
        <a class="logo-and-title" routerlink="/" href="http://github.com/vmware/dispatch">
            <!-- <span class="clr-icon clarity-logo"></span>
            <span class="title">Project Dispatch</span> -->
            <img class="dispatch-logo" src="/dispatch/assets/images/logo-small-200.png">
        </a>
    </div>
    <div class="divider"></div>
    <div class="header-nav clr-nav-level-1">
        <a class="nav-link " id="home-link" routerlink="/" routerlinkactive="active" href="/dispatch/"><span class="nav-text">Home</span></a>
        <a class="nav-link active" routerlink="/documentation" routerlinkactive="active" href="/dispatch/documentation/front/overview"><span class="nav-text">Documentation</span></a>
        <a class="nav-link " routerlink="/code" routerlinkactive="active" href="/dispatch/code"><span class="nav-text">Code</span></a>
        <a class="nav-link " routerlink="/community" routerlinkactive="active" href="/dispatch/community"><span class="nav-text">Community</span></a>
        <a class="nav-link " routerlink="/news" routerlinkactive="active" href="/dispatch/news"><span class="nav-text">What's New</span></a>
    </div>
    <div class="settings">
        <iframe class="github-btn" frameborder="0" height="20px" scrolling="0" src="https://ghbtns.com/github-btn.html?user=vmware&repo=dispatch&type=star&count=true" width="170px"></iframe>
    </div>

    <button class="header-overflow-trigger" type="button">
        <span></span>
    </button>
    <div class="header-backdrop"></div>
</clr-header>

            <documentation class="content-container"><router-outlet></router-outlet>
                <div class="content-area">
                    <section class="dox-content">
                    <h1 id="service-manager">Service Manager</h1>

<p>The purpose of the service manager is to provide a bridge between external services and functions. Two new concepts
will be introduced into Dispatch: catalogs which advertise available services, and services which represent a service
instance and a binding. The binding is transmitted to functions at execution time.</p>

<h2 id="problem-statement">Problem statement</h2>

<p>Functions are small stateless code artifacts.  Alone, they are not very useful. They need services like databases,
messangers, queues, etc. to address a wide variety of use-cases.</p>

<h3 id="user-stories-examples">User stories (examples)</h3>

<ol>
  <li>As a <strong>developer</strong>, I need to my function to connect to database.</li>
  <li>As an <strong>administrator</strong>, I want to manage the services and credentials that developer and their functions have
access to.</li>
  <li>As a <strong>developer/administrator</strong> I want a unified and consistent way of exposing services to developers and
functions.</li>
  <li>As an <strong>administrator</strong> I need an easy way to add arbitrary services, whether they are common and included with
Dispatch, or custom internal services.</li>
  <li>As a <strong>developer</strong>, I want a catalog of services that I can use with minimal effort/configuration.</li>
</ol>

<h2 id="proposed-solution">Proposed Solution</h2>

<p>A Service Manager component, responsible for catalog and service resources.  The service manager will provide a
Dispatch API layer on top of the <a href="https://github.com/kubernetes-incubator/service-catalog">Kubernetes service catalog</a>,
meaning that services must be Open Service Broker compatible.</p>

<p>While we could use the Kubernetes service catalog directly, there is no notion of tenancy so all services would be
globally available.  For Dispatch, we want the catalog to be organizationally scoped, meaning an administrator could
manage the catalog on a per-organization (perhaps per-application) basis.  Additionally, brokers should be dynamically
provisionable through the Dispatch API, without needing access to Kubernetes directly.  Therefore a light-weight
Dispatch service-manager API is required.</p>

<h3 id="brokers">Brokers</h3>

<p>Brokers are <a href="https://www.openservicebrokerapi.org">Open Service Broker API</a> (OSBAPI) compatible service brokers.  The
contain a set of service classes which are responsibile for provisioning and binding to the services the service
classes represent.  The brokers are identifiable via a URL and implement the OSBAPI.</p>

<p>Dispatch administrators manage the available brokers.  The brokers will be organization scoped.  Upon registering a
broker a list of service classes will be returned.</p>

<p>The following CRUD operations will be supported:</p>

<ul>
  <li>CREATE - register a broker via URL
    <ul>
      <li>optionally specify service classes to register</li>
    </ul>
  </li>
  <li>GET - return a broker object which lists all available service classes</li>
  <li>LIST - return all brokers</li>
  <li>DELETE - delete a broker and associated service classes</li>
</ul>

<h3 id="service-classes">Service Classes</h3>

<p>Service classes know how to provision and bind to particular services.  Once a broker is registered, a list of service
classes is made available.  Administrators may manage the list of services which are made available to developers.</p>

<p>The following CRUD operations will be supported:</p>

<ul>
  <li>CREATE - register a service class from a specific broker and make it available for the organization</li>
  <li>GET - return a service class object including available plans (and possibly schema)</li>
  <li>LIST - return all service classes</li>
  <li>DELETE - remove a service class making it unavailable to the organization</li>
</ul>

<h3 id="service-instance">Service Instance</h3>

<p>A service instance represents a provisioning or instance of a service.  For instance the instantiation of a postgres
service class would result in a provisioned database and a binding created (credentials stored as secrets).  The service
is identifieable with a unique name (e.g. <code class="highlighter-rouge">my-first-postgres</code>).  Functions can then be registered with services by name
(same was as secrets) and have the binding data injected into the function context (again, just like secrets).  In fact,
in this scenario the credentials are stored as secrets and the service instance maintains the secret name, which is how
the credentials are looked up.</p>

<p>The following CRUD operations will be supported:</p>

<ul>
  <li>CREATE - create a service instance from a service class
    <ul>
      <li>schema will be service class specific</li>
    </ul>
  </li>
  <li>GET - return the service which includes the binding information (e.g. Dispatch secret keys)</li>
  <li>LIST - return a list of all service instances</li>
  <li>DELETE - delete the service and do any service cleanup</li>
</ul>

<h2 id="design">Design</h2>

<p>As stated earlier, the service-manager is a light API layer on top of the kubernetes service catalog.  Additionally,
we are adding per-organization management of available services.</p>

<h3 id="broker-object-schema">Broker object schema</h3>

<ul>
  <li><code class="highlighter-rouge">name</code> - <code class="highlighter-rouge">string</code> - broker name</li>
  <li><code class="highlighter-rouge">URL</code> - <code class="highlighter-rouge">string</code> - URL to OSBAPI compatible broker</li>
  <li><code class="highlighter-rouge">parameters</code> - <code class="highlighter-rouge">map</code> - key/value paramteters passed as args to the broker</li>
  <li><code class="highlighter-rouge">serviceClasses</code> - <code class="highlighter-rouge">map</code> - key/serviceClass mapping (not sure if map or list)</li>
</ul>

<blockquote>
  <p>NOTE: Broker management will not be available immediately.</p>
</blockquote>

<h3 id="service-class-object-schema">Service Class object schema</h3>

<ul>
  <li><code class="highlighter-rouge">name</code> - <code class="highlighter-rouge">string</code> - service class name</li>
  <li><code class="highlighter-rouge">brokerID</code> - <code class="highlighter-rouge">string</code> - ID of broker</li>
  <li><code class="highlighter-rouge">plans</code> - <code class="highlighter-rouge">map</code> - key/servicePlan mapping
    <ul>
      <li>service plan objects may contain schema with regards to service creation and binding</li>
    </ul>
  </li>
</ul>

<h3 id="service-instance-object-schema">Service Instance object schema</h3>

<ul>
  <li><code class="highlighter-rouge">name</code> - <code class="highlighter-rouge">string</code> - service instance name</li>
  <li><code class="highlighter-rouge">serviceClassID</code> - <code class="highlighter-rouge">string</code> - ID of service class</li>
  <li><code class="highlighter-rouge">planID</code> - <code class="highlighter-rouge">string</code> - ID of service plan</li>
  <li><code class="highlighter-rouge">parameters</code> - <code class="highlighter-rouge">map</code> - parameters used for service provisioning and binding</li>
  <li><code class="highlighter-rouge">binding</code> - <code class="highlighter-rouge">map</code> - binding data (secret names) used by functions to use to this service instance</li>
</ul>

<h2 id="milestones">Milestones</h2>

<h3 id="phase-1">Phase 1</h3>

<ul>
  <li>Brokers
    <ul>
      <li>no Dispatch broker objects/APIs</li>
      <li>registered externally with kubernetes/service-catalog</li>
    </ul>
  </li>
  <li>Service Classes
    <ul>
      <li>pulled directly from service-catalog (auto-registered)</li>
      <li>read-only API (only GET/LIST operations)</li>
    </ul>
  </li>
  <li>Service Instance
    <ul>
      <li>CREATE/GET/LIST/DELETE all supported</li>
      <li>pass <code class="highlighter-rouge">--service &lt;serviceName&gt;</code> to function to inject binding data</li>
      <li>Binding data unpacked and repacked into Dispatch secret (kind of ugly)</li>
    </ul>
  </li>
</ul>


                    </section>
                </div>

                <nav class="sidenav clr-nav-level-2">
                    <section class="sidenav-content">
                    

                    
                    
                        <!-- front section is top level and has no label -->
                        <section class="nav-group collapsible">

                        
                            <ul class="nav-list">
                                <documentation-nav-links type="">
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/front/overview">Overview</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/front/roadmap">Roadmap</a></li>
                                
                                
                                </documentation-nav-links>
                            </ul>
                        </section>
                    
                    
                    
                        <!-- front section is top level and has no label -->
                        <section class="nav-group collapsible">

                        
                        
                            
                            <input id="Guides" type="checkbox" checked>
                            
                            <label for="Guides">Guides</label>
                        
                        
                            <ul class="nav-list">
                                <documentation-nav-links type="Guides">
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/guides/building">Building</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/guides/built-in-event-drivers">Built In Event Drivers</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/guides/custom-event-drivers">Custom Event Drivers</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/guides/docker-for-mac">Docker For Mac</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/guides/gke">Gke</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/guides/minikube">Minikube</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/guides/quickstart">Quickstart</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/guides/setup-authentication">Setup Authentication</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/guides/setup-service-acccount-authentication">Setup Service Acccount Authentication</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/guides/troubleshooting">Troubleshooting</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/guides/working-with-events">Working With Events</a></li>
                                
                                
                                </documentation-nav-links>
                            </ul>
                        </section>
                    
                    
                    
                        <!-- front section is top level and has no label -->
                        <section class="nav-group collapsible">

                        
                        
                            
                            <input id="posts" type="checkbox" checked>
                            
                            <label for="posts">Posts</label>
                        
                        
                            <ul class="nav-list">
                                <documentation-nav-links type="">
                                
                                
                                    <li><a class="nav-link" href="/dispatch/2018/05/23/v0-1-15-release.html">v0.1.15 Dispatch Release</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/2018/06/06/v0-1-16-release.html">v0.1.16 Dispatch Release</a></li>
                                
                                
                                </documentation-nav-links>
                            </ul>
                        </section>
                    
                    
                    
                        <!-- front section is top level and has no label -->
                        <section class="nav-group collapsible">

                        
                        
                            
                            <input id="Specifications" type="checkbox">
                            
                            <label for="Specifications">Specifications</label>
                        
                        
                            <ul class="nav-list">
                                <documentation-nav-links type="Specifications">
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/specs/api-gateway">Api Gateway</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/specs/application">Application</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/specs/development">Development</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/specs/dispatch">Dispatch</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/specs/error-handling">Error Handling</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/specs/event-gateway">Event Gateway</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/specs/event-manager">Event Manager</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/specs/function-gateway">Function Gateway</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/specs/function-schema-validation">Function Schema Validation</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/specs/identity-management">Identity Management</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/specs/image-manager">Image Manager</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/specs/language-support">Language Support</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/specs/rest-api">Rest Api</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/specs/secrets-store">Secrets Store</a></li>
                                
                                
                                
                                    <li><a class="nav-link active" routerlinkactive="active" href="/dispatch/documentation/specs/service-manager">Service Manager</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/specs/terminology">Terminology</a></li>
                                
                                
                                </documentation-nav-links>
                            </ul>
                        </section>
                    
                    
                    
                        <!-- front section is top level and has no label -->
                        <section class="nav-group collapsible">

                        
                        
                            
                            <input id="Usage" type="checkbox" checked>
                            
                            <label for="Usage">Usage</label>
                        
                        
                            <ul class="nav-list">
                                <documentation-nav-links type="Usage">
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/usage/api">API Endpoints</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/usage/event-drivers">Events Drivers and Subscriptions</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/usage/functions">Functions</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/usage/iam">Roles and Policies</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/usage/images">Images and Base Images</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/usage/services">Services Integration</a></li>
                                
                                
                                </documentation-nav-links>
                            </ul>
                        </section>
                    
                    
                    </section>
                </nav>
            </documentation>
        <footer></footer>
<script>
    anchors.add();
</script>
<script src="/dispatch/assets/js/scale.fix.js"></script>
        </clr-main-container>
    </body>
</html>