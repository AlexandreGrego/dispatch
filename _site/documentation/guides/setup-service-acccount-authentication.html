<!doctype html>
<html lang="en-US">
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">

    <!-- Begin Jekyll SEO tag v2.3.0 -->
<title>Setup Service Acccount Authentication | Dispatch Serverless Framework</title>
<meta property="og:title" content="Setup Service Acccount Authentication" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Service Accounts in Dispatch" />
<meta property="og:description" content="Service Accounts in Dispatch" />
<link rel="canonical" href="http://localhost:4000/dispatch/documentation/guides/setup-service-acccount-authentication" />
<meta property="og:url" content="http://localhost:4000/dispatch/documentation/guides/setup-service-acccount-authentication" />
<meta property="og:site_name" content="Dispatch Serverless Framework" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-06-11T14:24:45-07:00" />
<script type="application/ld+json">
{"name":null,"description":"Service Accounts in Dispatch","author":null,"@type":"BlogPosting","url":"http://localhost:4000/dispatch/documentation/guides/setup-service-acccount-authentication","publisher":null,"image":null,"headline":"Setup Service Acccount Authentication","dateModified":"2018-06-11T14:24:45-07:00","datePublished":"2018-06-11T14:24:45-07:00","sameAs":null,"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/dispatch/documentation/guides/setup-service-acccount-authentication"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/dispatch/assets/node_modules/@clr/icons/clr-icons.min.css">
    <script src="/dispatch/assets/node_modules/@webcomponents/custom-elements/custom-elements.min.js"></script>
    <script src="/dispatch/assets/node_modules/@clr/icons/clr-icons.min.js"></script>
    <script src="/dispatch/assets/node_modules/anchor-js/anchor.js"></script>
    <link rel="stylesheet" href="/dispatch/assets/node_modules/@clr/ui/clr-ui.min.css">
    <script defer src="https://use.fontawesome.com/releases/v5.0.7/js/all.js"></script>
    <link rel="stylesheet" href="/dispatch/assets/css/style.css?v=cd131ece455317a0ce1219b8b78ef55e8e6bf546">
    <meta name="viewport" content="width=device-width">
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/dispatch/assets/images/dispatch.ico/apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="/dispatch/assets/images/dispatch.ico/apple-touch-icon-152x152.png" />
    <link rel="icon" type="image/png" href="/dispatch/assets/images/dispatch.ico/favicon-32x32.png" sizes="32x32" />
    <link rel="icon" type="image/png" href="/dispatch/assets/images/dispatch.ico/favicon-16x16.png" sizes="16x16" />
    <meta name="application-name" content="&nbsp;"/>
    <meta name="msapplication-TileColor" content="#FFFFFF" />
    <meta name="msapplication-TileImage" content="/dispatch/assets/images/dispatch.ico/mstile-144x144.png" />

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
</head>
    <body>
        <clr-main-container class="main-container">
        <clr-header class="header-6 header">
    <button class="header-hamburger-trigger" type="button">
        <span></span>
    </button>

    <div class="branding">
        <a class="logo-and-title" routerlink="/" href="http://github.com/vmware/dispatch">
            <!-- <span class="clr-icon clarity-logo"></span>
            <span class="title">Project Dispatch</span> -->
            <img class="dispatch-logo" src="/dispatch/assets/images/logo-small-200.png">
        </a>
    </div>
    <div class="divider"></div>
    <div class="header-nav clr-nav-level-1">
        <a class="nav-link " id="home-link" routerlink="/" routerlinkactive="active" href="/dispatch/"><span class="nav-text">Home</span></a>
        <a class="nav-link active" routerlink="/documentation" routerlinkactive="active" href="/dispatch/documentation/front/overview"><span class="nav-text">Documentation</span></a>
        <a class="nav-link " routerlink="/code" routerlinkactive="active" href="/dispatch/code"><span class="nav-text">Code</span></a>
        <a class="nav-link " routerlink="/community" routerlinkactive="active" href="/dispatch/community"><span class="nav-text">Community</span></a>
        <a class="nav-link " routerlink="/news" routerlinkactive="active" href="/dispatch/news"><span class="nav-text">What's New</span></a>
    </div>
    <div class="settings">
        <iframe class="github-btn" frameborder="0" height="20px" scrolling="0" src="https://ghbtns.com/github-btn.html?user=vmware&repo=dispatch&type=star&count=true" width="170px"></iframe>
    </div>

    <button class="header-overflow-trigger" type="button">
        <span></span>
    </button>
    <div class="header-backdrop"></div>
</clr-header>

            <documentation class="content-container"><router-outlet></router-outlet>
                <div class="content-area">
                    <section class="dox-content">
                    <h1 id="service-accounts-in-dispatch">Service Accounts in Dispatch</h1>

<p>Users in Dispatch are managed by an external <a href="/dispatch/documentation/guides/setup-authentication">Identity Provider (IDP)</a> e.g OpenID Connect provider like vIDM, Dex etc. As such, when users login to dispatch they will be redirected to the configured OIDC provider for authentication.
This authentication step involves the end-user and that works in their best interest. For non-human users, like a CI/CD system, a third-party application or service interacting with Dispatch API’s, a special kind of user account is required.
Dispatch calls them as Service Accounts and they are completely managed by Dispatch’s Identity Manager.</p>

<p>Service accounts can be created and managed using Dispatch CLI or API’s. Service account authentication involves the generation of a JWT bearer token by the client and the token must be signed using one of the “RS256/384/512” - JSON Web Signature algorithms. If you are using the CLI, most of the token generation and signing is already taken care.</p>

<h2 id="1-generate-a-rsa-key-pair">1. Generate a RSA key pair</h2>
<p>Before creating a service account, we need to generate a RSA public/private key pair. You can use any key length greater than 2048 bits.  The private key will be used by the client to sign the JWT token and specify it as a bearer token in the Authorization HTTP header of any API request. The public key will be used on server side to validate the JWT token in the API requests.
Hence, Dispatch only requires you to specify the public key when creating a service account in Dispatch. Make sure to keep the private key safe with the process or application that will interact with Dispatch.</p>

<p>Use following openssl commands to generate a key pair:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>openssl genrsa <span class="nt">-out</span> &lt;PRIVATE_KEY&gt; 4096
<span class="nv">$ </span>openssl rsa <span class="nt">-in</span> &lt;PRIVATE_KEY&gt; <span class="nt">-pubout</span> <span class="nt">-outform</span> PEM <span class="nt">-out</span> &lt;PUBLIC_KEY&gt;
</code></pre></div></div>

<h2 id="2-create-service-account">2. Create Service Account</h2>
<p>Login to dispatch and use the public key from the previous setup to create a service account:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Create service account - example-svc-account</span>
<span class="nv">$ </span>dispatch iam create serviceaccount <span class="se">\</span>
      example-svc-account <span class="se">\</span>
      <span class="nt">--public-key</span> ./example-user.key.pub
<span class="o">&gt;</span> Create service account: example-svc-account
</code></pre></div></div>
<p>The name of the service account is important when generating the jwt token and it must be specified in the issuer field <code class="highlighter-rouge">iss</code> of the jwt payload. More about this is covered in the usage section below.</p>

<h2 id="3-create-a-policy">3. Create a Policy</h2>
<p>Similar to user accounts, service accounts are not useful unless an access policy is created. Create a policy and associate it with the service account:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Create policy for the service account</span>
<span class="nv">$ </span>dispatch iam create policy <span class="se">\</span>
      example-svc-policy <span class="se">\</span>
      <span class="nt">--subject</span> example-svc-account <span class="nt">--action</span> <span class="s2">"*"</span> <span class="nt">--resource</span> <span class="s2">"function"</span> <span class="se">\</span>
      <span class="nt">--service-account</span> &lt;SERVICE_ACCOUNT_NAME&gt;
<span class="o">&gt;</span> Created policy: example-svc-policy
</code></pre></div></div>

<h2 id="4-using-the-service-account">4. Using the Service Account</h2>
<p>When invoking dispatch commands, specify the private key associated with the <em>example-user.key.pub</em> that we used to create this service account in the <code class="highlighter-rouge">--jwt-private-key</code> flag. Dispatch CLI will
use this private key to sign the generated JWT token.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>dispatch create <span class="nt">-f</span> seed.yaml <span class="nt">--service-account</span> example-svc-account <span class="nt">--jwt-private-key</span> ../example-user.key
Created BaseImage: nodejs-base
Created BaseImage: python3-base
Created BaseImage: powershell-base
Created Image: nodejs
Created Image: python3
Created Image: powershell
Created Function: hello-py
Created Function: http-py
Created Function: hello-js
Created Function: hello-ps1
Created Secret: open-sesame

<span class="nv">$ </span>dispatch get base-image <span class="nt">--service-account</span> example-svc-account <span class="nt">--jwt-private-key</span> ../example-user.key
       NAME       |                   URL                   | STATUS |         CREATED DATE
<span class="nt">------------------------------------------------------------------------------------------------</span>
  python3-base    | dispatchframework/python3-base:0.0.7    | READY  | Sat Jan  1 14:40:18 PST 0000
  nodejs-base     | dispatchframework/nodejs-base:0.0.6     | READY  | Sat Jan  1 14:40:18 PST 0000
  powershell-base | dispatchframework/powershell-base:0.0.8 | READY  | Sat Jan  1 14:40:18 PST 0000
</code></pre></div></div>

<p>If you are directly calling the API instead of using the CLI, you need to create a JWT payload as follows:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
 </span><span class="s2">"iss"</span><span class="p">:</span><span class="w"> </span><span class="s2">"example-svc-account"</span><span class="p">,</span><span class="w">
 </span><span class="s2">"iat"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1525930134"</span><span class="p">,</span><span class="w">
 </span><span class="s2">"exp"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1525865330"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>
<p>, then sign the payload with the associated private key using one of RS256/384/512 algorithms and present it in the HTTP Authorization header as a bearer token e.g <code class="highlighter-rouge">Authorization : Bearer &lt;JWT_TOKEN&gt;</code>. You can learn more about JWT tokens <a href="https://jwt.io/introduction/">here</a>.</p>

                    </section>
                </div>

                <nav class="sidenav clr-nav-level-2">
                    <section class="sidenav-content">
                    

                    
                    
                        <!-- front section is top level and has no label -->
                        <section class="nav-group collapsible">

                        
                            <ul class="nav-list">
                                <documentation-nav-links type="">
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/front/overview">Overview</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/front/roadmap">Roadmap</a></li>
                                
                                
                                </documentation-nav-links>
                            </ul>
                        </section>
                    
                    
                    
                        <!-- front section is top level and has no label -->
                        <section class="nav-group collapsible">

                        
                        
                            
                            <input id="Guides" type="checkbox">
                            
                            <label for="Guides">Guides</label>
                        
                        
                            <ul class="nav-list">
                                <documentation-nav-links type="Guides">
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/guides/building">Building</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/guides/built-in-event-drivers">Built In Event Drivers</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/guides/custom-event-drivers">Custom Event Drivers</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/guides/docker-for-mac">Docker For Mac</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/guides/gke">Gke</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/guides/minikube">Minikube</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/guides/quickstart">Quickstart</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/guides/setup-authentication">Setup Authentication</a></li>
                                
                                
                                
                                    <li><a class="nav-link active" routerlinkactive="active" href="/dispatch/documentation/guides/setup-service-acccount-authentication">Setup Service Acccount Authentication</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/guides/troubleshooting">Troubleshooting</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/guides/working-with-events">Working With Events</a></li>
                                
                                
                                </documentation-nav-links>
                            </ul>
                        </section>
                    
                    
                    
                        <!-- front section is top level and has no label -->
                        <section class="nav-group collapsible">

                        
                        
                            
                            <input id="posts" type="checkbox" checked>
                            
                            <label for="posts">Posts</label>
                        
                        
                            <ul class="nav-list">
                                <documentation-nav-links type="">
                                
                                
                                    <li><a class="nav-link" href="/dispatch/2018/05/23/v0-1-15-release.html">v0.1.15 Dispatch Release</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/2018/06/06/v0-1-16-release.html">v0.1.16 Dispatch Release</a></li>
                                
                                
                                </documentation-nav-links>
                            </ul>
                        </section>
                    
                    
                    
                        <!-- front section is top level and has no label -->
                        <section class="nav-group collapsible">

                        
                        
                            
                            <input id="Specifications" type="checkbox" checked>
                            
                            <label for="Specifications">Specifications</label>
                        
                        
                            <ul class="nav-list">
                                <documentation-nav-links type="Specifications">
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/specs/api-gateway">Api Gateway</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/specs/application">Application</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/specs/development">Development</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/specs/dispatch">Dispatch</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/specs/error-handling">Error Handling</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/specs/event-gateway">Event Gateway</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/specs/event-manager">Event Manager</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/specs/function-gateway">Function Gateway</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/specs/function-schema-validation">Function Schema Validation</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/specs/identity-management">Identity Management</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/specs/image-manager">Image Manager</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/specs/language-support">Language Support</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/specs/rest-api">Rest Api</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/specs/secrets-store">Secrets Store</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/specs/service-manager">Service Manager</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/specs/terminology">Terminology</a></li>
                                
                                
                                </documentation-nav-links>
                            </ul>
                        </section>
                    
                    
                    
                        <!-- front section is top level and has no label -->
                        <section class="nav-group collapsible">

                        
                        
                            
                            <input id="Usage" type="checkbox" checked>
                            
                            <label for="Usage">Usage</label>
                        
                        
                            <ul class="nav-list">
                                <documentation-nav-links type="Usage">
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/usage/api">API Endpoints</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/usage/event-drivers">Events Drivers and Subscriptions</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/usage/functions">Functions</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/usage/iam">Roles and Policies</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/usage/images">Images and Base Images</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/usage/services">Services Integration</a></li>
                                
                                
                                </documentation-nav-links>
                            </ul>
                        </section>
                    
                    
                    </section>
                </nav>
            </documentation>
        <footer></footer>
<script>
    anchors.add();
</script>
<script src="/dispatch/assets/js/scale.fix.js"></script>
        </clr-main-container>
    </body>
</html>