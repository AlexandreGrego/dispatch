<!doctype html>
<html lang="en-US">
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">

    <!-- Begin Jekyll SEO tag v2.3.0 -->
<title>Working With Events | Dispatch Serverless Framework</title>
<meta property="og:title" content="Working With Events" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Working with Events in Dispatch" />
<meta property="og:description" content="Working with Events in Dispatch" />
<link rel="canonical" href="http://localhost:4000/dispatch/documentation/guides/working-with-events" />
<meta property="og:url" content="http://localhost:4000/dispatch/documentation/guides/working-with-events" />
<meta property="og:site_name" content="Dispatch Serverless Framework" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-06-11T14:24:45-07:00" />
<script type="application/ld+json">
{"name":null,"description":"Working with Events in Dispatch","author":null,"@type":"BlogPosting","url":"http://localhost:4000/dispatch/documentation/guides/working-with-events","publisher":null,"image":null,"headline":"Working With Events","dateModified":"2018-06-11T14:24:45-07:00","datePublished":"2018-06-11T14:24:45-07:00","sameAs":null,"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/dispatch/documentation/guides/working-with-events"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/dispatch/assets/node_modules/@clr/icons/clr-icons.min.css">
    <script src="/dispatch/assets/node_modules/@webcomponents/custom-elements/custom-elements.min.js"></script>
    <script src="/dispatch/assets/node_modules/@clr/icons/clr-icons.min.js"></script>
    <script src="/dispatch/assets/node_modules/anchor-js/anchor.js"></script>
    <link rel="stylesheet" href="/dispatch/assets/node_modules/@clr/ui/clr-ui.min.css">
    <script defer src="https://use.fontawesome.com/releases/v5.0.7/js/all.js"></script>
    <link rel="stylesheet" href="/dispatch/assets/css/style.css?v=cd131ece455317a0ce1219b8b78ef55e8e6bf546">
    <meta name="viewport" content="width=device-width">
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/dispatch/assets/images/dispatch.ico/apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="/dispatch/assets/images/dispatch.ico/apple-touch-icon-152x152.png" />
    <link rel="icon" type="image/png" href="/dispatch/assets/images/dispatch.ico/favicon-32x32.png" sizes="32x32" />
    <link rel="icon" type="image/png" href="/dispatch/assets/images/dispatch.ico/favicon-16x16.png" sizes="16x16" />
    <meta name="application-name" content="&nbsp;"/>
    <meta name="msapplication-TileColor" content="#FFFFFF" />
    <meta name="msapplication-TileImage" content="/dispatch/assets/images/dispatch.ico/mstile-144x144.png" />

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
</head>
    <body>
        <clr-main-container class="main-container">
        <clr-header class="header-6 header">
    <button class="header-hamburger-trigger" type="button">
        <span></span>
    </button>

    <div class="branding">
        <a class="logo-and-title" routerlink="/" href="http://github.com/vmware/dispatch">
            <!-- <span class="clr-icon clarity-logo"></span>
            <span class="title">Project Dispatch</span> -->
            <img class="dispatch-logo" src="/dispatch/assets/images/logo-small-200.png">
        </a>
    </div>
    <div class="divider"></div>
    <div class="header-nav clr-nav-level-1">
        <a class="nav-link " id="home-link" routerlink="/" routerlinkactive="active" href="/dispatch/"><span class="nav-text">Home</span></a>
        <a class="nav-link active" routerlink="/documentation" routerlinkactive="active" href="/dispatch/documentation/front/overview"><span class="nav-text">Documentation</span></a>
        <a class="nav-link " routerlink="/code" routerlinkactive="active" href="/dispatch/code"><span class="nav-text">Code</span></a>
        <a class="nav-link " routerlink="/community" routerlinkactive="active" href="/dispatch/community"><span class="nav-text">Community</span></a>
        <a class="nav-link " routerlink="/news" routerlinkactive="active" href="/dispatch/news"><span class="nav-text">What's New</span></a>
    </div>
    <div class="settings">
        <iframe class="github-btn" frameborder="0" height="20px" scrolling="0" src="https://ghbtns.com/github-btn.html?user=vmware&repo=dispatch&type=star&count=true" width="170px"></iframe>
    </div>

    <button class="header-overflow-trigger" type="button">
        <span></span>
    </button>
    <div class="header-backdrop"></div>
</clr-header>

            <documentation class="content-container"><router-outlet></router-outlet>
                <div class="content-area">
                    <section class="dox-content">
                    <h1 id="working-with-events-in-dispatch">Working with Events in Dispatch</h1>

<p>Dispatch is designed to accept events from different sources. To be able to do that, Dispatch introduces a concept of event driver.
An Event Driver is an image that knows how to ingest events from a particular source. For example, if you would like to run your functions
in reaction to events coming from VMware vCenter, you would create an event driver of type <code class="highlighter-rouge">vcenter</code>. There are built-in types,
you can also register your own type by providing a specially crafted image.</p>

<h2 id="implementation">Implementation</h2>

<p>Event drivers are implemented as Kubernetes Pods. When a new event driver is created, a new Kubernetes pod is deployed,
with configuration matching the one provided in the request. The pod is wrapped in the deployment, so that it will be
rescheduled/restarted if needed. See <a href="custom-event-drivers.md">Registering custom event driver</a> for more details.</p>

<h2 id="how-to-use-event-driver-in-your-environment">How to use event driver in your environment</h2>

<h3 id="adding-event-driver">Adding event driver</h3>

<p>You can use Dispatch CLI or API to add an event driver (UI support coming soon). In the following example, we’re adding
a new vCenter event driver.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dispatch create event-driver vcenter --name vcenter1.corp.local
</code></pre></div></div>

<p>The above will create a new event driver of type <code class="highlighter-rouge">vcenter</code> and –name <code class="highlighter-rouge">vcenter1.corp.local</code>. Creating an event-driver
takes a while - monitor its status by running:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dispatch get event-driver vcenter1.corp.local
</code></pre></div></div>

<p>When the status changes to <code class="highlighter-rouge">RUNNING</code>, the event driver is ready to use.</p>

<p>Event driver by itself doesn’t do much. it produces events which are ingested by Dispatch, but Dispatch does not know what
to do with them yet. To tell Dispatch to react to events, you need to create a subscription.</p>

<h2 id="working-with-subscriptions">Working with subscriptions</h2>
<h3 id="adding-subscription">Adding subscription</h3>

<p>Subscription tells Dispatch to match certain events to certain functions, so that when events matching defined conditions arrive
to the system, these functions will be executed. Events that do not match any subscriptions are automatically dropped.</p>

<p>To add a new subscription for the <code class="highlighter-rouge">vm.being.created</code> event in a vcenter event driver, run:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dispatch create subscription --source-type vcenter --event-type vm.being.created myFunction
</code></pre></div></div>

<p>The above command will print output similar to the following:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>           NAME          | SOURCE TYPE |    EVENT TYPE    | FUNCTION NAME | STATUS |         CREATED DATE
---------------------------------------------------------------------------------------------------------
  complete-cicada-410962 | vcenter     | vm.being.created | myFunction    | READY  | Fri Dec 31 17:18:54 PST -0001
</code></pre></div></div>

<p>The above subscription will cause dispatch to execute function <code class="highlighter-rouge">myFunction</code> for every event of type <code class="highlighter-rouge">vm.being.created</code>. 
What is source type? If you create event driver of <code class="highlighter-rouge">vcenter</code> type, <code class="highlighter-rouge">vcenter</code> is your source type. When source type is not specified,
it defaults to “dispatch” (when you emit an event using CLI, source type also defaults to “dispatch”).</p>

<p>You can also specify a name for your subscription using <code class="highlighter-rouge">--name</code> parameter. if you don’t, a random, human-readable name will be created.</p>

<h3 id="event-driver-event-types">Event driver event types</h3>

<p>To find out the list of event types produced by built-in event drivers, see <a href="built-in-event-drivers.md">Built-in Event Drivers</a>.</p>

<h2 id="emitting-events-via-cli-or-api">Emitting events via CLI or API</h2>

<p>Event driver is a powerful concept, but there are cases when you want to emit an event by yourself or through some external application.</p>

<h3 id="emitting-events-via-cli">Emitting events via CLI</h3>

<p>To emit an event using CLI, you can use the <code class="highlighter-rouge">dispatch emit</code> subcommand.</p>

<p>In the following example, We emit an event of type <code class="highlighter-rouge">my.event</code>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dispatch emit my.event --data '{ "example": "payload"}'
</code></pre></div></div>

<p>Events in Dispatch follow <a href="https://github.com/cloudevents/spec/blob/460a90d7a69f6257246487e37746797aa2ae919f/spec.md">Cloud Events specification</a>.
There are certain attributes in Cloud Events that are mandatory. when emitting them through the CLI, the CLI will pick reasonable defaults.
You can customize those defaults using CLI attributes:</p>

<ul>
  <li><code class="highlighter-rouge">--event-namespace</code> - Event namespace. Defaults to <code class="highlighter-rouge">dispatchframework.io</code></li>
  <li><code class="highlighter-rouge">--source-type</code> - Event source type. Defaults to <code class="highlighter-rouge">dispatch</code></li>
  <li><code class="highlighter-rouge">--source-id</code> - Event source ID. Defaults to <code class="highlighter-rouge">dispatch</code></li>
  <li><code class="highlighter-rouge">--event-id</code> - Event ID, should be unique within the scope of producer. Defaults to generated UUIDv4. 
NOTE: If source ID is <code class="highlighter-rouge">dispatch</code>, event-id will ALWAYS be overwritten by Dispatch and set to random UUIDv4.</li>
</ul>

<p>You can also provide following optional details about the emitted event:</p>
<ul>
  <li><code class="highlighter-rouge">--event-type-version</code> - Version of the event, specific to the source. Defaults to empty string.</li>
  <li><code class="highlighter-rouge">--schema-url</code> - URL to schema describing event data. Defaults to empty string.</li>
  <li><code class="highlighter-rouge">--content-type</code> - Content Type of optional data payload. Defaults to <code class="highlighter-rouge">application/json</code> when using <code class="highlighter-rouge">--data</code>, or automatically
detected type when using <code class="highlighter-rouge">--data-from-file</code>. If specified, always takes precedence over detected type.</li>
</ul>

<p>You can provide data payload for Event using <code class="highlighter-rouge">--data</code> parameter. <code class="highlighter-rouge">--data-from-file</code> will read the content from the specified
file path. Use the <code class="highlighter-rouge">--binary</code> switch to automatically encode the data using base64. If dispatch CLI detects binary type,
the content will automatically be base64-encoded.</p>

<h3 id="emitting-events-via-api">Emitting events via API</h3>

<p>You can also emit an event using Dispatch API directly. Here is an example using cURL:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-X</span> <span class="s2">"POST"</span> <span class="s2">"https://</span><span class="k">${</span><span class="nv">DISPATCH_URL</span><span class="k">}</span><span class="s2">/v1/event/"</span> <span class="se">\</span>
     <span class="nt">-H</span> <span class="s1">'Cookie: cookie'</span> <span class="se">\</span>
     <span class="nt">-H</span> <span class="s1">'Content-Type: application/json; charset=utf-8'</span> <span class="se">\</span>
     <span class="nt">-d</span> <span class="s1">$'{
  "event": {
    "source-type": "dispatch",
    "content-type": "application/json",
    "event-time": "2018-03-02T23:31:35.818-08:00",
    "event-type": "test.event33",
    "event-id": "b4620ea5-8e9d-42d5-a566-6ad2f7873d63",
    "cloud-events-version": "0.1",
    "namespace": "dispatchframework.io",
    "source-id": "dispatch"
  }
}'</span>
</code></pre></div></div>

                    </section>
                </div>

                <nav class="sidenav clr-nav-level-2">
                    <section class="sidenav-content">
                    

                    
                    
                        <!-- front section is top level and has no label -->
                        <section class="nav-group collapsible">

                        
                            <ul class="nav-list">
                                <documentation-nav-links type="">
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/front/overview">Overview</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/front/roadmap">Roadmap</a></li>
                                
                                
                                </documentation-nav-links>
                            </ul>
                        </section>
                    
                    
                    
                        <!-- front section is top level and has no label -->
                        <section class="nav-group collapsible">

                        
                        
                            
                            <input id="Guides" type="checkbox">
                            
                            <label for="Guides">Guides</label>
                        
                        
                            <ul class="nav-list">
                                <documentation-nav-links type="Guides">
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/guides/building">Building</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/guides/built-in-event-drivers">Built In Event Drivers</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/guides/custom-event-drivers">Custom Event Drivers</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/guides/docker-for-mac">Docker For Mac</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/guides/gke">Gke</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/guides/minikube">Minikube</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/guides/quickstart">Quickstart</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/guides/setup-authentication">Setup Authentication</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/guides/setup-service-acccount-authentication">Setup Service Acccount Authentication</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/guides/troubleshooting">Troubleshooting</a></li>
                                
                                
                                
                                    <li><a class="nav-link active" routerlinkactive="active" href="/dispatch/documentation/guides/working-with-events">Working With Events</a></li>
                                
                                
                                </documentation-nav-links>
                            </ul>
                        </section>
                    
                    
                    
                        <!-- front section is top level and has no label -->
                        <section class="nav-group collapsible">

                        
                        
                            
                            <input id="posts" type="checkbox" checked>
                            
                            <label for="posts">Posts</label>
                        
                        
                            <ul class="nav-list">
                                <documentation-nav-links type="">
                                
                                
                                    <li><a class="nav-link" href="/dispatch/2018/05/23/v0-1-15-release.html">v0.1.15 Dispatch Release</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/2018/06/06/v0-1-16-release.html">v0.1.16 Dispatch Release</a></li>
                                
                                
                                </documentation-nav-links>
                            </ul>
                        </section>
                    
                    
                    
                        <!-- front section is top level and has no label -->
                        <section class="nav-group collapsible">

                        
                        
                            
                            <input id="Specifications" type="checkbox" checked>
                            
                            <label for="Specifications">Specifications</label>
                        
                        
                            <ul class="nav-list">
                                <documentation-nav-links type="Specifications">
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/specs/api-gateway">Api Gateway</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/specs/application">Application</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/specs/development">Development</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/specs/dispatch">Dispatch</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/specs/error-handling">Error Handling</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/specs/event-gateway">Event Gateway</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/specs/event-manager">Event Manager</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/specs/function-gateway">Function Gateway</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/specs/function-schema-validation">Function Schema Validation</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/specs/identity-management">Identity Management</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/specs/image-manager">Image Manager</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/specs/language-support">Language Support</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/specs/rest-api">Rest Api</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/specs/secrets-store">Secrets Store</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/specs/service-manager">Service Manager</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/specs/terminology">Terminology</a></li>
                                
                                
                                </documentation-nav-links>
                            </ul>
                        </section>
                    
                    
                    
                        <!-- front section is top level and has no label -->
                        <section class="nav-group collapsible">

                        
                        
                            
                            <input id="Usage" type="checkbox" checked>
                            
                            <label for="Usage">Usage</label>
                        
                        
                            <ul class="nav-list">
                                <documentation-nav-links type="Usage">
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/usage/api">API Endpoints</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/usage/event-drivers">Events Drivers and Subscriptions</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/usage/functions">Functions</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/usage/iam">Roles and Policies</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/usage/images">Images and Base Images</a></li>
                                
                                
                                
                                    <li><a class="nav-link" href="/dispatch/documentation/usage/services">Services Integration</a></li>
                                
                                
                                </documentation-nav-links>
                            </ul>
                        </section>
                    
                    
                    </section>
                </nav>
            </documentation>
        <footer></footer>
<script>
    anchors.add();
</script>
<script src="/dispatch/assets/js/scale.fix.js"></script>
        </clr-main-container>
    </body>
</html>